/*
       _          _          _ _
 _ __ (_)_  _____| | ___  __| (_)
| '_ \| \ \/ / _ \ |/ _ \/ _` | |
| |_) | |>  <  __/ |  __/ (_| | |
| .__/|_/_/\_\___|_|\___|\__,_|_|
|_|

https://links.pixeledi.eu
lopaka test mit u8gs | 11.2025

*/

#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64

U8G2_SSD1306_128X64_NONAME_F_HW_I2C u8g2(U8G2_R0, U8X8_PIN_NONE);

const byte poti = A0;

static const unsigned char image_battery_10_bits[] U8X8_PROGMEM = {
    0x00, 0x00, 0x00, 0xf0, 0xff, 0x7f, 0x08, 0x00, 0x80, 0x08, 0x00, 0xa0,
    0x0e, 0x00, 0xa0, 0x01, 0x00, 0xa0, 0x01, 0x00, 0xa0, 0x01, 0x00, 0xa0,
    0x01, 0x00, 0xa0, 0x01, 0x00, 0xa0, 0x0e, 0x00, 0xa0, 0x08, 0x00, 0xa0,
    0x08, 0x00, 0x80, 0xf0, 0xff, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_battery_50_bits[] U8X8_PROGMEM = {
    0x00, 0x00, 0x00, 0xf0, 0xff, 0x7f, 0x08, 0x00, 0x80, 0x08, 0xc0, 0xb6,
    0x0e, 0xc0, 0xb6, 0x01, 0xc0, 0xb6, 0x01, 0xc0, 0xb6, 0x01, 0xc0, 0xb6,
    0x01, 0xc0, 0xb6, 0x01, 0xc0, 0xb6, 0x0e, 0xc0, 0xb6, 0x08, 0xc0, 0xb6,
    0x08, 0x00, 0x80, 0xf0, 0xff, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_battery_full_bits[] U8X8_PROGMEM = {
    0x00, 0x00, 0x00, 0xf0, 0xff, 0x7f, 0x08, 0x00, 0x80, 0x68, 0xdb, 0xb6,
    0x6e, 0xdb, 0xb6, 0x61, 0xdb, 0xb6, 0x61, 0xdb, 0xb6, 0x61, 0xdb, 0xb6,
    0x61, 0xdb, 0xb6, 0x61, 0xdb, 0xb6, 0x6e, 0xdb, 0xb6, 0x68, 0xdb, 0xb6,
    0x08, 0x00, 0x80, 0xf0, 0xff, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_Layer_9_bits[] U8X8_PROGMEM = {
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
    0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0xc0, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0xc0, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x01, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0x01, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xf1, 0x01,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
    0x8f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0d, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00};

void drawLopakaUI(int temp, int hum, int battery) {

  u8g2.clearBuffer();
  u8g2.setFontMode(1);
  u8g2.setBitmapMode(1);
  // Batterie: 3 Stufen
  if (battery < 33)
    u8g2.drawXBMP(95, 7, 24, 16, image_battery_10_bits);
  else if (battery < 66)
    u8g2.drawXBMP(95, 8, 24, 13, image_battery_50_bits);
  else
    u8g2.drawXBMP(95, 7, 24, 16, image_battery_full_bits);

  // Werte
  u8g2.setFont(u8g2_font_t0_22b_tr);
  char buf1[8];
  sprintf(buf1, "%d°", temp);
  u8g2.drawUTF8(22, 35, buf1);

  u8g2.setFont(u8g2_font_t0_17b_tr);
  char buf2[8];
  sprintf(buf2, "%d%%", hum);
  u8g2.drawStr(63, 45, buf2);

  u8g2.drawRFrame(1, 1, 126, 62, 8);

  u8g2.drawEllipse(34, 28, 25, 21);

  u8g2.drawEllipse(71, 38, 20, 19);

  // u8g2.setFont(u8g2_font_t0_22b_tr);
  // u8g2.drawStr(18, 35, "23");
  //
  // u8g2.setFont(u8g2_font_t0_16_tr);
  // u8g2.drawStr(64, 45, "55");

  u8g2.drawXBMP(9, 1, 105, 53, image_Layer_9_bits);

  u8g2.sendBuffer();
}

// --------------------------------------------------

void setup() {
  Serial.begin(115200);
  Wire.begin();
  u8g2.begin();
  u8g2.setBusClock(400000);
  delay(200);
  u8g2.clearBuffer();
  u8g2.setFont(u8g2_font_ncenB08_tr);
  u8g2.drawStr(20, 32, "Lopaka Ready!");
  u8g2.sendBuffer();
  delay(1000);
}

// --------------------------------------------------

void loop() {
  yield();
  int temp = random(18, 33);
  int hum = random(30, 80);
  int raw = analogRead(poti);
  int battery = map(raw, 0, 4095, 0, 100);

  drawLopakaUI(temp, hum, battery);

  Serial.printf("Temp: %d°C  Hum: %d%%  Batt: %d%%  (Raw: %d)\n", temp, hum,
                battery, raw);
  delay(150);
}
